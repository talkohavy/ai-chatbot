import type { Response } from 'express';

const shouldThrowError = false;

export async function sendThinkingMockResponse(res: Response) {
  // Send start events
  res.write(`data: ${JSON.stringify({ type: 'start' })}\n\n`);
  res.write(`data: ${JSON.stringify({ type: 'start-step' })}\n\n`);

  // Reasoning step
  res.write(`data: ${JSON.stringify({ type: 'reasoning-start', id: '0' })}\n\n`);

  const reasoningDeltas = [
    'The user is asking for',
    ' a sample',
    ' of data from multiple',
    ' different',
    ' domains:',
    '\n1. A',
    ' user (from',
    ' d',
    'ex-platform)\n2. A',
    ' scout (from synthetic',
    '-monitoring)\n3. A V',
    'DI host (from vdi)',
    '\n4. A cu4d device',
    ' (from cu4d)\n5',
    '. A cu4c device (from',
    ' cu4c)\n6. A',
    ' workflow (from workflows)\n7.',
    ' A random bit from the knowledge base (',
    'from cu',
    '-knowledge-base)\n\nSince',
    ' these',
    ' are all',
    ' independent queries',
    ' with',
    ' no dependencies,',
    ' I should',
    ' make all the calls in parallel',
    ' in',
    ' a',
    ' single function_calls block.',
    '\n\nLet',
    ' me verify',
    ' the tools I',
    ' need:',
    '\n1',
    '. __',
    'mcp__d',
    'ex-platform__',
    'list',
    '-',
    'users -',
    ' to get ',
    '1 user\n2. __m',
    'cp__synthetic-monitoring__list-',
    'scouts',
    ' - to get 1 scout',
    '\n3. __mcp__vdi',
    '__get',
    '-host',
    '-counts',
    ' - hm',
    'm, this',
    ' gets',
    ' counts',
    ',',
    ' not hosts',
    '.',
    ' Let me check other',
    ' V',
    'DI tools...',
    ' I',
    ' could',
    ' use __mcp__vdi__',
    'get',
    '-machine',
    '-statistics',
    ' with',
    ' group',
    'ing by host to',
    ' get host information',
    '\n4. __mcp__cu',
    '4d__list',
    '_',
    'devices - to get 1 device',
    '\n5. __mcp__cu',
    '4c__list-',
    'devices - to get 1 device',
    '\n6. __mcp__workflows',
    '__list-flows',
    ' - to get 1 workflow',
    '\n7. __mcp__cu-',
    'knowledge-base__search',
    ' -',
    ' to search',
    ' the knowledge base\n\nFor',
    ' most',
    " of these, I'll set",
    ' _',
    'limit',
    ' or',
    ' page',
    'Size to 1 to get just',
    ' one result',
    '.',
    '\n\nFor',
    ' the V',
    'DI host',
    ", I'll",
    ' use get',
    '-machine',
    '-statistics with grouping=',
    'host',
    ' to',
    ' get host data',
    '.',
    ' I',
    ' need to provide',
    ' time',
    'From',
    ' and timeTo parameters.',
    ' Let',
    ' me use',
    ' a recent',
    ' time',
    ' range',
    ',',
    ' like the',
    ' last ',
    '24',
    ' hours.\n\nCurrent',
    ' time is',
    ': 2026',
    '-01-26T07:05',
    ':51.887Z',
    '\n24',
    ' hours ago would be: 2',
    '026-01-25',
    'T07:05:51.887',
    'Z\n\nFor',
    ' the knowledge',
    " base search, I'll search",
    ' for something',
    ' general',
    ' like',
    ' "',
    'ControlUp features',
    '" to',
    ' get',
    ' a random',
    ' interesting',
    ' bit.',
    '',
    '',
  ];

  for (const delta of reasoningDeltas) {
    res.write(`data: ${JSON.stringify({ type: 'reasoning-delta', id: '0', delta })}\n\n`);
    await new Promise((resolve) => setTimeout(resolve, 50));
  }

  res.write(
    `data: ${JSON.stringify({ type: 'reasoning-delta', id: '0', delta: '', providerMetadata: { anthropic: { signature: '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' } } })}\n\n`,
  );
  res.write(`data: ${JSON.stringify({ type: 'reasoning-end', id: '0' })}\n\n`);

  // Text start
  res.write(`data: ${JSON.stringify({ type: 'text-start', id: '1' })}\n\n`);

  const initialTextDeltas = [
    "I'll retrieve a",
    ' sample from',
    ' each domain',
    ' for you. Let me gather',
    ' this',
    ' data',
    ' in',
    ' parallel:',
  ];

  for (const delta of initialTextDeltas) {
    res.write(`data: ${JSON.stringify({ type: 'text-delta', id: '1', delta })}\n\n`);
    await new Promise((resolve) => setTimeout(resolve, 200));
  }

  if (shouldThrowError) {
    res.socket?.destroy();
    return;
  }

  res.write(`data: ${JSON.stringify({ type: 'text-end', id: '1' })}\n\n`);

  // Tool calls
  const toolCalls = [
    {
      toolCallId: 'toolu_01AKYU1RYkR5euvdnDEcoam2',
      toolName: '__mcp__dex-platform__list-users',
      input: { _limit: 1 },
    },
    {
      toolCallId: 'toolu_01QvC4QjCgZcMtf6x36FccKg',
      toolName: '__mcp__synthetic-monitoring__list-scouts',
      input: { page: 1 },
    },
    {
      toolCallId: 'toolu_01L54Yz7cTPJSRd8tex8wPY6',
      toolName: '__mcp__vdi__get-machine-statistics',
      input: {
        grouping: 'host',
        aggregationType: 'Avg',
        metricsType: 'Default',
        _timeFrom: '2026-01-25T07:05:51.887Z',
        _timeTo: '2026-01-26T07:05:51.887Z',
        _limit: 1,
      },
    },
    {
      toolCallId: 'toolu_01Em9UmHu7q3mtVyrwkHVWgF',
      toolName: '__mcp__cu4d__list_devices',
      input: { pageSize: 1, page: 1 },
    },
    {
      toolCallId: 'toolu_01CXWnSVoMqFr4gKfphBhTXy',
      toolName: '__mcp__cu4c__list-devices',
      input: { _limit: 1, _page: 1 },
    },
    {
      toolCallId: 'toolu_01M8Dn3eYFZ4EQTMpYbpa69m',
      toolName: '__mcp__workflows__list-flows',
      input: { _limit: 1, _page: 1 },
    },
    {
      toolCallId: 'toolu_0125h2xJ3nERXuxQKPdyRe6d',
      toolName: '__mcp__cu-knowledge-base__search',
      input: { query: 'ControlUp features and capabilities', topK: 1 },
    },
  ];

  for (const toolCall of toolCalls) {
    res.write(`data: ${JSON.stringify({ type: 'tool-input-available', ...toolCall, dynamic: true })}\n\n`);
    await new Promise((resolve) => setTimeout(resolve, 100));
  }

  // Tool outputs
  const toolOutputs = [
    {
      toolCallId: 'toolu_01AKYU1RYkR5euvdnDEcoam2',
      output: {
        content: [],
        structuredContent: {
          metadata: {
            total: 201,
            limitPerPage: 1,
            currentPageNumber: 1,
            currentPageSize: 1,
            remaining: 200,
          },
          data: [
            {
              id: '008fce6f-f3e2-42f8-825f-171d17d25a73',
              email: 'refael.vax+msp3@controlup.com',
              fullName: 'Rafi Vax',
              firstName: 'Rafi',
              lastName: 'Vax',
              avatar: null,
              phone: '+972545357086',
              region: 'us',
              eulaVersion: '1',
              createdAt: '2025-02-20T08:33:21.807Z',
              updatedAt: '2025-02-20T08:41:27.530Z',
            },
          ],
        },
        isError: false,
        cuRequestId: '7d1bd475-eb34-424d-9d21-d4fedd7126f6',
      },
    },
    {
      toolCallId: 'toolu_01QvC4QjCgZcMtf6x36FccKg',
      output: {
        content: [],
        structuredContent: {
          current_page: 1,
          data: [
            {
              address: '8.8.8.8',
              createdAt: '2025-07-06 08:40:09',
              deleted: false,
              disabled: false,
              domain: null,
              hives: { cloud: [21] },
              interval: 5,
              labels: [],
              lastRun: 1769410936092,
              options: {
                maxttl: 30,
                minttl: 1,
                numPaths: 1,
                protocol: 'ICMP',
                timeout: 3.6,
              },
              scoutId: 11430,
              scoutName: 'Eilon - Google DNS Availability escape-edited',
              subType: 'net_traceroute',
              type: 'network',
            },
          ],
          success: true,
          total: 2,
          total_pages: 1,
        },
        isError: false,
        cuRequestId: '7d1bd475-eb34-424d-9d21-d4fedd7126f6',
      },
    },
    {
      toolCallId: 'toolu_01CXWnSVoMqFr4gKfphBhTXy',
      output: {
        content: [],
        structuredContent: {
          metadata: {
            cuRequestId: '7d1bd475-eb34-424d-9d21-d4fedd7126f6',
            orgId: '1f1584b6-4659-4d5a-aa5f-addcd7bafbf7',
            userId: 'fd077c4d-b3ee-47d5-8f8b-2487166c9402',
            total: 4,
            limitPerPage: 1,
            currentPageNumber: 1,
            currentPageSize: 1,
            remaining: 3,
          },
          data: [
            {
              device_id: 'xlg-k5sBvP1AE640Ay1Y',
              device_name: 'AI-WIN-QA-SDX-1.QA.LOCAL',
              agent_status: 'online',
              os_name: 'Microsoft Windows 11 Pro',
              mac_address: '00:50:56:ff:fe:a0:02:5b',
              local_ip: '10.20.24.212',
              public_ip: '212.199.160.204',
              security_controls: [
                {
                  control_id: 'f70522ef-5e82-4e36-a3ba-9e25e5ad17f0',
                  name: 'CrowdStrike Falcon',
                },
              ],
              last_scan: null,
              score: '10.0',
              score_severity: 'LOW',
              issues_count: 0,
              device_group: 'dex_ai',
              device_tags: [],
              location: 'Israel - Jerusalem',
              client_version: '1.5.2512.25',
            },
          ],
        },
        isError: false,
        cuRequestId: '7d1bd475-eb34-424d-9d21-d4fedd7126f6',
      },
    },
    {
      toolCallId: 'toolu_01M8Dn3eYFZ4EQTMpYbpa69m',
      output: {
        content: [],
        structuredContent: {
          data: [
            {
              id: '18461b5d-e8f0-4818-afe7-23c4e2f1f8c0',
              name: 'test flow',
              status: '',
              description: '',
            },
          ],
          metadata: {
            _page: 1,
            _limit: 1,
            _order: 'asc',
            _expand: false,
          },
        },
        isError: false,
        cuRequestId: '7d1bd475-eb34-424d-9d21-d4fedd7126f6',
      },
    },
    {
      toolCallId: 'toolu_01Em9UmHu7q3mtVyrwkHVWgF',
      output: {
        content: [],
        structuredContent: {
          items: [
            {
              id: 'xlg-k5sBvP1AE640Ay1Y',
              name: 'AI-WIN-QA-SDX-1.QA.LOCAL',
              dnsName: 'ai-win-qa-sdx-1.qa.local',
              platform: 'Windows',
              isOnline: true,
              lastCommunication: '2026-01-26T07:05:24.134Z',
              group: 'dex_ai',
              tags: [],
            },
          ],
          page: 1,
          pageSize: 1,
          totalCount: 10,
          totalPages: 10,
        },
        isError: false,
        cuRequestId: '7d1bd475-eb34-424d-9d21-d4fedd7126f6',
      },
    },
    {
      toolCallId: 'toolu_0125h2xJ3nERXuxQKPdyRe6d',
      output: {
        content: [],
        structuredContent: {
          results: [
            {
              rank: 0,
              score: 0.0313725508749485,
              content:
                '## What are the benefits of using the ControlUp Agent?\n\nIn a nutshell, the ControlUp Agent provides the following features:\n\n#### In-depth monitoring\n\n* Fine-grained performance metrics of machines, sessions, processes any many more\n* Assessment of computer stress level\n* Find and remediate problems quickly\n\n#### Advanced management actions\n\n* Manage systems services, registry and file system of multiple machines simultaneously\n* Interact with user sessions, controlling their state and activity\n* Run, terminate, or limit resource consumption for any process on your network\n\n#### Automation features\n\n* Automate script actions based on threshold crossings\n* Activate triggers when certain conditions are met\n* Run follow-up actions such as sending an email alert, creating a Windows event or [sending a webhook](using-webhooks-as-follow-up-action.html) over the Internet\n\n#### Configuration comparison of different computers with respect to\n\n* Registry values and keys\n* System services, including startup type, current state, and service credentials\n* Installed software packages and updates\n* Irregular or non-uniform configurations of file systems',
            },
          ],
        },
        isError: false,
        cuRequestId: '667cab61-cc48-4885-8883-80366f5d9e45',
      },
    },
    {
      toolCallId: 'toolu_01L54Yz7cTPJSRd8tex8wPY6',
      output: {
        content: [],
        structuredContent: {
          metadata: {
            orgId: '1a2ccb05-0104-4e5f-aa84-75149e64587a',
            infraGuid: '1f1584b6-4659-4d5a-aa5f-addcd7bafbf7',
            region: 'US',
            userId: 'fd077c4d-b3ee-47d5-8f8b-2487166c9402',
            total: 11,
            limitPerPage: 1,
            currentPageNumber: 1,
            currentPageSize: 1,
            remaining: 10,
          },
          data: [
            {
              organization_id: 11000,
              entity_id: -8560407485545345000,
              host_name: 'esx06.smartx.dom',
              update_time: '2026-01-26T07:00:00Z',
              cpu_count: 8,
              cpu_cores: 8,
              cpu_speed: 2397,
              total_ram: 16,
              hypervisor_platform: 'VMware',
              az_region: null,
              az_subscription_id: null,
              az_os_disk_sku_size: null,
              az_disks_count: null,
              az_total_disks_size_gb: null,
              az_os_disk_size_gb: null,
              uptime_in_sec: 796760,
              cpu_avg: 1,
              memory_in_use_avg: 44,
              disk_read_kbyte_per_sec_avg: null,
              disk_write_kbyte_per_sec_avg: null,
              disk_total_kbyte_per_sec_avg: null,
              system_drive_free_space_avg: 11,
              disk_reads_per_sec_avg: 0,
              disk_writes_per_sec_avg: 1,
              disk_transfers_per_sec_avg: 1,
              network_received_mbit_per_sec_avg: 0,
              network_sent_mbit_per_sec_avg: 0,
              app_load_time_avg: null,
              non_zero_avg_user_input_delay_avg: null,
              non_zero_max_user_input_delay_avg: null,
              avg_disk_queue_avg: 0,
              logon_duration_avg: 46,
              page_faults_per_sec_avg: 3,
              processes_count_avg: 106,
              avg_processor_queue_length_avg: 0,
              gpu_number_of_cores: null,
              gpu_utilization_avg: null,
              gpu_available_memory_avg: null,
              gpu_frame_buffer_size_avg: 0,
              gpu_frame_buffer_memory_utilization_avg: null,
              gpu_memory_usage_avg: null,
              gpu_decoder_usage_avg: null,
              gpu_encoder_usage_avg: null,
              pvs_device_free_space_on_write_cache_drive_avg: null,
              pvs_ram_cache_usage_avg: null,
              pvs_target_device_health_avg: -1,
              pvs_device_write_cache_volume_size_avg: null,
              pvs_device_boot_retry_count_last: null,
              pvs_device_boot_time_sec_last: null,
              pvs_device_disk_type: null,
              pvs_device_server_reconnect_count_last: null,
              pvs_device_udp_retry_count_last: null,
              total_sessions_avg: 2,
              active_sessions_avg: 0,
              user_sessions_avg: 0,
              idle_sessions_avg: 0,
              disconnected_sessions_avg: 0,
              other_sessions_count_avg: 0,
              ica_sessions_count_avg: 0,
              session_disconnect_rate_avg: 0,
            },
          ],
        },
        isError: false,
        cuRequestId: '7d1bd475-eb34-424d-9d21-d4fedd7126f6',
      },
    },
  ];

  for (const toolOutput of toolOutputs) {
    res.write(`data: ${JSON.stringify({ type: 'tool-output-available', ...toolOutput, dynamic: true })}\n\n`);
    await new Promise((resolve) => setTimeout(resolve, 150));
  }

  res.write(`data: ${JSON.stringify({ type: 'finish-step' })}\n\n`);

  // Second step with final response
  res.write(`data: ${JSON.stringify({ type: 'start-step' })}\n\n`);
  res.write(`data: ${JSON.stringify({ type: 'text-start', id: '0' })}\n\n`);

  const finalTextDeltas = [
    'Perfect',
    '! Here',
    "'s a",
    ' sample',
    ' from',
    ' each domain:\n\n---',
    '\n\n####',
    ' ',
    '1. **DE',
    'X Platform',
    ' User',
    '**\n|',
    ' Field',
    ' | Value |\n|----',
    '---|-------|\n| **Name',
    '** | Rafi Vax',
    ' |\n| **Email** | ref',
    'ael.vax+msp3',
    '@controlup.com |\n|',
    ' **Phone** | +972545357',
    '086 |\n| **Region**',
    ' | US |\n| **User',
    ' ID** | 008fce6',
    'f-f3e2-42',
    'f8-825f-171d',
    '17d25a73 |',
    '\n| **Created',
    '** | 2025-02-',
    '20 ',
    '08',
    ':33:21 ',
    '|\n\n---\n\n#### 2.',
    ' **Synthetic Monitoring Scout',
    '**\n| Field | Value |',
    '\n|-------|-------|\n| **',
    'Scout',
    ' Name',
    '** | Eilon - Google DNS',
    ' Availability escape-edited |\n|',
    ' **Type',
    '** | Network',
    ' -',
    ' Traceroute |\n| **Target',
    '** | 8.8.8',
    '.8 (',
    'Google DNS) |\n| **',
    'Interval** | 5 minutes',
    ' |\n| **Scout',
    ' ID** | 11430 |',
    '\n| **Last',
    ' Run** | Active',
    ' (',
    'recently',
    ' ran',
    ') |',
    '\n| **Protocol',
    '** | ICMP |\n|',
    ' **H',
    'ives** | Cloud',
    ' Hive',
    ' ',
    '21 |',
    '\n\n---\n\n#### 3. **V',
    'DI Host',
    '**\n| Field | Value |',
    '\n|-------|-------|\n| **',
    'Host Name** | esx06.',
    'smartx.dom |\n| **',
    'Hyper',
    'visor** | VMware |',
    '\n| **CPU',
    ' Count',
    '** | 8 cores',
    ' @',
    ' 2397 MHz |\n|',
    ' **Total',
    ' RAM** | 16 GB |',
    '\n| **CPU',
    ' Usage',
    ' (',
    'Avg)** | 1%',
    ' |\n| **Memory Usage (',
    'Avg)** | 44% |',
    '\n| **Up',
    'time**',
    ' | 9',
    '.',
    '2',
    ' days',
    ' |\n| **Total',
    ' Sessions',
    '** | 2 (',
    'avg',
    ') |\n| **',
    'Disk',
    ' Free',
    ' Space** | 11% |',
    '\n\n---\n\n#### 4. **',
    'ControlUp for',
    ' Des',
    'ktops (',
    'C',
    'U',
    '4D)',
    ' Device',
    '**\n| Field | Value |',
    '\n|-------|-------|\n| **',
    'Name',
    '** | AI-WIN-QA',
    '-SDX-1.QA',
    '.LOCAL |\n| **DNS',
    ' Name** | ai-win-qa',
    '-sdx-1.qa.',
    'local |\n| **Platform** |',
    ' Windows |\n| **Status',
    '** | Online ',
    '✅',
    ' |\n| **Group',
    '** | dex_ai |',
    '\n| **Last',
    ' Communication',
    '** | 2026-01-',
    '26 ',
    '07:05:24 |',
    '\n| **Device',
    ' ID',
    '** | xlg-k5',
    'sBvP1AE640',
    'Ay1Y |',
    '\n\n---\n\n####',
    ' 5. **',
    'ControlUp for Compliance',
    ' (CU4C) Device**',
    '\n| Field | Value |\n|',
    '-------|-------|\n| **Device',
    ' Name',
    '** | AI-WIN-QA',
    '-SDX-1.QA',
    '.LOCAL |\n| **OS',
    '** | Microsoft Windows 11 Pro',
    ' |\n| **Status',
    '** | Online ✅ |',
    '\n| **Security',
    ' Score',
    '** | 10.0 (',
    'LOW severity',
    ') |\n| **Issues Count**',
    ' | 0 |\n| **',
    'Security',
    ' Controls** | CrowdStrike',
    ' Falcon |',
    '\n| **Location',
    '** | Israel - Jerusalem |',
    '\n| **Agent',
    ' Version',
    '** | 1.5.2',
    '512.25 |',
    '\n| **MAC',
    ' Address** | 00:50:',
    '56:ff:fe:a0',
    ':02:5b |\n\n---',
    '\n\n####',
    ' 6. **Workflow',
    '**',
    '\n| Field | Value |\n|',
    '-------|-------|\n| **Name',
    '** | test flow |\n| **',
    'Workflow ID** | 18461b',
    '5d-e8f0-',
    '4818-afe7-23',
    'c4e2f1f8',
    'c0 |\n| **Status',
    '** | (',
    'Not',
    ' specified) |\n| **Description',
    '** | (Empty',
    ') |',
    '\n\n---\n\n#### 7. **Knowledge',
    ' Base',
    ' Insight',
    ':',
    ' Benefits',
    ' of the',
    ' ControlUp Agent**',
    '\n\nThe',
    ' ControlUp Agent provides powerful',
    ' features across',
    ' four',
    ' key',
    ' areas:\n\n**',
    'In-depth',
    ' Monitoring:**',
    '\n- Fine',
    '-grained performance metrics for machines,',
    ' sessions, and',
    ' processes\n- Computer',
    ' stress level',
    ' assessment\n- Quick',
    ' problem identification and remediation\n\n**Advanced',
    ' Management:**',
    '\n- Simult',
    'aneous management of system',
    ' services, registry, and file systems across',
    ' multiple machines\n- User',
    ' session control and interaction',
    '\n- Process',
    ' resource',
    ' consumption',
    ' management',
    '\n\n**Automation:**',
    '\n- Script',
    ' actions triggered',
    ' by threshold crossings\n- Conditional',
    ' triggers',
    ' with',
    ' follow-up actions (',
    'email alerts, Windows events,',
    ' webhooks)',
    '\n\n**Configuration Comparison:**',
    '\n- Registry',
    ' values and keys analysis',
    '\n- System services configuration',
    ' tracking',
    '\n- Software',
    ' packages',
    ' and updates inventory',
    '\n- File',
    ' system configuration',
    ' monitoring',
    '\n\n---',
    '\n\n**',
    'Summary',
    ':**',
    ' Your',
    ' environment',
    ' has active',
    ' monitoring',
    ' across',
    ' endpoints',
    ' (',
    '10',
    ' C',
    'U4D devices, 4 ',
    'CU4C devices),',
    ' V',
    'DI infrastructure',
    ' (11',
    ' hosts), and external',
    ' resources',
    ' (2',
    ' ',
    'Scouts',
    '). The sample',
    ' device',
    ' shown',
    ' (AI',
    '-WIN-QA-SDX',
    '-1)',
    ' appears in',
    ' both',
    ' C',
    'U4D and CU4C',
    ' monitoring',
    ' with',
    ' excellent',
    ' security',
    ' pos',
    'ture (',
    'score',
    ':',
    ' 10.0,',
    ' zero',
    ' issues)',
    ' and protected',
    ' by CrowdStrike Falcon',
    '.',
  ];

  for (const delta of finalTextDeltas) {
    res.write(`data: ${JSON.stringify({ type: 'text-delta', id: '0', delta })}\n\n`);
    await new Promise((resolve) => setTimeout(resolve, 100));
  }

  res.write(`data: ${JSON.stringify({ type: 'text-end', id: '0' })}\n\n`);
  res.write(`data: ${JSON.stringify({ type: 'finish-step' })}\n\n`);
  res.write(
    `data: ${JSON.stringify({ type: 'finish', finishReason: 'stop', usage: { inputTokens: 44529, outputTokens: 1157, totalTokens: 45686, reasoningTokens: 0, cachedInputTokens: 0 } })}\n\n`,
  );
  res.write('data: [DONE]\n\n');

  res.end();
}
